{% extends "base_layout.html" %}
{% load listtocolumns i18n tagutils settingstag media extendedtags geoip urltag %}
{% block title %}{{ block.super }} | {{client.name}}{% endblock %}
{% block extra_header %}
{{ block.super }}
{% jscript "js/jquery.jeditable.mini.js" %}
{% jscript "js/client.js" %}
<script type="text/javascript">
$(document).ready(function() {
	{% if perms.b3connect.change_client_group %} 	
    $('#client_group').editable('{% url change_clientgroup client.id %}', {
    	loadurl  : '{% url group_list_json %}', 
        type    : 'select',
        submit  : '{% trans "Save" %}'
    });
    {% endif %}
});
</script>
{% endblock %}
{% block navigation2 %}
{% include "webfront/client/client_menu.html" %}
{% endblock %}
{% block main_content %}
<table class="cd-table client_detail">
<caption><h3>{{client.name}}<small>  
{% with request.session.server as current_server %}
{% for server in request.server_list %}
{% if current_server == server.DB %}{{server.NAME}}{%endif%}
{% endfor %}
{% endwith %}
</small>
{% if client.ip %}
<small>
{% geolocation client.ip %}
</small>
{% endif %}
{% ifinstalled "plugins.follow" %}
{% if client.followed.all %}
<a href="{% url follow_home %}#F{{client.id}}" class="nodecoration_icon icon_watch" title="{% trans "This user is under suspicion of cheating" %}"></span>
{% endif %}
{% endifinstalled %}
</h3>
</caption>
<thead class="table_menu">
<tr><td colspan="4">
<ul>
{% ifinstalled "plugins.follow" %}
{% if client.followed.all %}
{% if perms.delete_follow %}
<li><a href="{% url follow_remove client.id %}">{% trans "Remove from watch list" %}</a></li>
{% endif %}
{% else %}
{% if perms.add_follow %}
<li><a href="{% url follow_add client.id %}">{% trans "Add to watch list" %}</a></li>
{% endif %}
{% endif %}
{% endifinstalled %}
</ul>
</td></tr>
</thead>
<tbody>
<tr>
<th>{% trans "Name" %}</th><td>{{client.name}}{% ifinstalled "plugins.chatlog" %}&nbsp;&nbsp;<a title="{% trans "See what this player was talking about" %}" href="{% url chat_list %}?name=@{{client.id}}&search=Search" class="nodecoration_icon icon_chat">&nbsp;</a>{% endifinstalled %}</td>
<th>{% trans "@id" %}</th><td>{{client.id}}</td>
</tr>
<tr>
<th>{% trans "Level" %}</th>
{% if perms.b3connect.view_group %}
<td id="client_group"
{% if perms.b3connect.change_client_group %}
title="{% trans "Edit" %}" class="nodecoration_icon icon_edit"
{% else %}
{% if perms.b3connect.register_client and client.group.id < 2%}
title="{% trans "Register" %}" class="nodecoration_icon icon_useradd" onclick="register_user('{% url change_clientgroup client.id %}',2)" 
{% endif %}
{% endif %}>
{{client.displayGroup}}</td>
{% else %}
<td>-</td>
{% endif %}
<th>{% trans "Connections" %}</th><td>{{client.connections}}</td>
</tr>
<tr>
<th>{% trans "First Seen" %}</th><td>{{client.time_add|date:"DATETIME_FORMAT"}}</td>
<th>{% trans "Last Seen" %}</th><td>{{client.time_edit|date:"DATETIME_FORMAT"}}{% ifinstalled "plugins.status" %}<a href="{% url client_status_log client.id %}" title="{% trans "Expand" %}" class="nodecoration_icon icon_table"></a>{% endifinstalled %}</td>
</tr>
<tr>
<th>{% trans "IP Address" %}</th>
<td>{% if client.ip %}
<a href="{% url client_list %}?type=ip&data={{client.ip}}&search=Search">{{client.ip}}</a>
<a target="_blank" href="http://whois.domaintools.com/{{client.ip}}" title="{% trans "Whois IP search" %}" class="nodecoration_icon icon_vcard"></a>
<a target="_blank" href="{% setting 'GEOTOOL' %}{{client.ip}}" title="{% trans "Show location of IP origin on map" %}" class="nodecoration_icon icon_world"></a>
{% if client.ip in banlist %}<span class="nodecoration_icon icon_exclamation" title="{% trans "This IP is in the banlist" %}">&nbsp;</span>{% endif %}
{% else %}{% trans "(No IP address available)" %}{% endif %}</td>
<td colspan="2">{% if status %}{%if client.id in status %}<span class="online">{% trans "Playing" %}</span>{%else%}<span class="offline">{% trans "Offline" %}</span>{%endif%}{%endif%}</td>
</tr>
</tbody>
</table>
<br/>
<!-- ************************ ALIASES ************************ -->
{% if perms.b3connect.view_aliases %}
<table id="client_aliases" class="cd-table client_lists">
<caption>{% trans "Aliases" %}</caption>
<thead>
<tr>
<th>{% trans "Name" %}</th>
<th>{% trans "Times Used" %}</th>
<th>{% trans "First Used" %}</th>
<th>{% trans "Last Used" %}</th>
<th>{% trans "IP Address" %}</th>
</tr>
</thead>
<tbody id="aliases">
{% with client.aliases.all|slice:":5" as aliases %} 
{% include "webfront/client/client_aliases.html" %}
{% endwith %}
</tbody>
{% if client.aliases.all|length > 5 %}
<tfoot>
<tr>
<td colspan="5">
<span class="link right" onclick="do_call_get('{% url client_more_alias client.id %}','aliases', '#client_aliases tfoot')">{% trans "more ..." %}</span>
</td>
</tr>
</tfoot>
{% endif %}
</table>
<br/>
{% endif %}
<!-- ************************ PENALTIES ************************ -->
{% if perms.b3connect.view_penalty %}
<table class="cd-table client_lists">
<caption>{% trans "Active Penalties" %}{% if perms.b3connect.add_penalty %}<a title="{% trans "Add" %}" href="{% url add_penalty client.id %}" class="nodecoration_icon icon_add">&nbsp;</a>{% endif %}</caption>
<thead>
<tr>
<th>{% trans "Type" %}</th>
<th>{% trans "Added" %}</th>
<th>{% trans "Duration" %}</th>
<th>{% trans "Expires" %}</th>
<th>{% trans "Reason" %}</th>
<th>{% trans "Admin" %}</th>
</tr>
</thead>
<tbody>
{% for penalty in client.penalties.active_bans %}
<tr class="{% cycle "odd" "even" %}">
<td>{{penalty.get_type_display}}
{% if perms.b3connect.delete_penalty and penalty.inactive == 0 %}
<a href="{% url disable_penalty penalty.id %}" title="{% trans "De-active" %}" class="nodecoration_icon icon_delete"></a>
{% endif %}
{% if perms.b3connect.change_penalty and penalty.inactive == 0 %}
<a href="{% url edit_penalty penalty.id %}" title="{% trans "Edit" %}" class="nodecoration_icon icon_edit">&nbsp;</a>
{% endif %}
&nbsp;
</td>
<td>{{penalty.time_add|date:"DATETIME_FORMAT"}}</td>
<td>{% if penalty.inactive == 0 %}{% if penalty.duration != 0 %}{{penalty.display_duration}}{%endif%}{%endif%}</td>
<td>{% if penalty.inactive == 1 %}<span style="font-weight: bold;">{% trans "De-activated" %}</span>{%else%}{% if penalty.duration != 0 %}{{penalty.time_expire|date:"DATETIME_FORMAT"}}{%else%}<span style="color:red;">{% trans "Permanent" %}</span>{%endif%}{%endif%}</td>
<td>{{penalty.reason|clean_colors}}</td>
<td>{% if perms.b3connect.view_high_level_client %}{% if penalty.admin %}<a href="{% serverurl client_detail penalty.admin.id %}">{{penalty.admin.name}}</a>{% else %}B3{%endif%}{% else %}-{%endif%}</td>
</tr>
{% empty %}
<tr class="odd">
<td colspan="6">{% trans "No penalties" %}</td>
</tr>
{% endfor %}
</tbody>
</table>
<br/>
{% endif %}
<!-- ************************ NOTICES ************************ -->
{% if perms.b3connect.view_notices %}
<table id="client_notice" class="cd-table client_lists">
<caption>{% trans "Notices" %}{% if perms.b3connect.add_notice %}<a title="{% trans "Add" %}" href="{% url add_notice client.id %}" class="nodecoration_icon icon_add">&nbsp;</a>{% endif %}</caption>
<thead>
<tr>
<th>{% trans "Added" %}</th>
<th>{% trans "Reason" %}</th>
<th>{% trans "Admin" %}</th>
</tr>
</thead>
<tbody id="notices">
{% with client.penalties.notices|slice:":5" as notices %} 
{% include "webfront/client/client_notices.html" %}
{% endwith %}
</tbody>
{% if client.penalties.notices|length > 5 %}
<tfoot>
<tr>
<td colspan="5">
<span class="link right" onclick="do_call_get('{% url client_more_notices client.id %}','notices', '#client_notice tfoot')">{% trans "more ..." %}</span>
</td>
</tr>
</tfoot>
{% endif %}
</table>
{% endif %}
<br/>
<!-- ************************ PAST PENALTIES ************************ -->
<table id="past_penalties" class="cd-table client_lists">
<caption>{% trans "Past Penalties" %}</caption>
<thead>
<tr>
<th>{% trans "Type" %}</th>
<th>{% trans "Added" %}</th>
<th>{% trans "Duration" %}</th>
<th>{% trans "Expires" %}</th>
<th>{% trans "Reason" %}</th>
<th>{% trans "Admin" %}</th>
</tr>
</thead>
<tbody id="pastpenalty">
{% with client.penalties.inactive|slice:":2" as penalties %} 
{% include "webfront/client/client_penalties.html" %}
{% endwith %}
</tbody>
{% if client.penalties.inactive|length > 2 %}
<tfoot>
<tr>
<td colspan="6">
<span class="link right" onclick="do_call_get('{% url client_more_ipenalties client.id %}','pastpenalty', '#past_penalties tfoot')">{% trans "more ..." %}</span>
</td>
</tr>
</tfoot>
{% endif %}
</table>
<br/>
{% if perms.b3connect.view_high_level_client %}    
<table id="admin_actions" class="cd-table client_lists">
<caption>{% trans "Admin Actions" %}</caption>
<thead>
<tr>
<th>{% trans "Type" %}</th>
<th>{% trans "Added" %}</th>
<th>{% trans "Duration" %}</th>
<th>{% trans "Expires" %}</th>
<th>{% trans "Reason" %}</th>
<th>{% trans "Client" %}</th>
</tr>
</thead>
<tbody id="adminact">
{% with client.adminpenalties.all|slice:":5" as penalties %} 
{% include "webfront/client/client_adminactions.html" %}
{% endwith %}
</tbody>
{% if client.adminpenalties.all|length > 5 %}
<tfoot>
<tr>
<td colspan="6">
<span class="link right" onclick="do_call_get('{% url client_more_admactions client.id %}','adminact', '#admin_actions tfoot')">{% trans "more ..." %}</span>
</td>
</tr>
</tfoot>
{% endif %}
</table>
{% endif %}
{% endblock %}