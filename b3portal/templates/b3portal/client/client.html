{% extends "base_layout.html" %}
{% load i18n tagutils settingstag extendedtags geoip urltag plugintag gametag %}
{% block title %}{{ block.super }} | {{client.name}}{% endblock %}
{% block extra_header %}
{{ block.super }}
<link rel="stylesheet" type="text/css" href="{% setting "UI_MEDIA_PATH" %}{% setting "UI_VERSION" %}/themes/base/jquery-ui.css"/>
<script type="text/javascript" src="{% setting "UI_MEDIA_PATH" %}{% setting "UI_VERSION" %}/jquery-ui.min.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/jquery.jeditable.mini.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/client.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/client2.js"></script>
<script type="text/javascript">
$(document).ready(function() {
	$("#add_notice_link").on('click',function() {
	    var dialog = $('<div style="display:none; text-align: left;"></div>').appendTo('body');
	    var url = $(this).attr('alt');
	    dialog.load(
	        url, 
	        function (responseText, textStatus, XMLHttpRequest) {
	            dialog.dialog({
	            	modal: true,
	            	width: 550,
	                close: function(event, ui) {
	                    dialog.remove();
	                }
	            });
	        }
	    );
	    dialog.on('submit','form', function(ev) {
	    	ev.preventDefault();
	    	$.post($(this).attr('action'),
	    			$(this).serializeArray(),
	    			function(data, status, xr) {
	    				if (typeof(data) === "string") {
	    					// TODO
	    				} else {
	    					$(ev.delegateTarget).dialog('close');
	    					update_user_messages(function() { load_notices(); });
	    				}
	    			}
	    	);
	    });
	});

	$("#add_penalty_link").on('click',function() {
	    var dialog = $('<div style="display:none; text-align: left;"></div>').appendTo('body');
	    var url = $(this).attr('alt');
	    dialog.load(
	        url, 
	        function (responseText, textStatus, XMLHttpRequest) {
	            dialog.dialog({
	            	modal: true,
	            	width: 550,
	                close: function(event, ui) {
	                    dialog.remove();
	                }
	            });
	        }
	    );
	    dialog.on('submit','form', function(ev) {
	    	ev.preventDefault();
	    	$.post($(this).attr('action'),
	    			$(this).serializeArray(),
	    			function(data, status, xr) {
	    				if (typeof(data) === "string") {
	    					// TODO
	    				} else {
	    					$(ev.delegateTarget).dialog('close');
	    					update_user_messages(function() { load_penalties(); });
	    				}
	    			}
	    	);
	    });
	});
	
	{% if obj_perms.portal.updatelevel or obj_perms.portal.reglevel %}
    $('#client_group.icon_edit').editable('{% serverurl change_clientgroup client.id %}', {
    	data   : '{{group_data|safe}}',
        type    : 'select',
        submit  : '{% trans "Save" %}',
        indicator : '{% trans "Saving..." %}'
    });		
    {% endif %}
});

</script>
{% endblock %}
{% block navigation2 %}
{% include "b3portal/client/client_menu.html" %}
{% endblock %}
{% block main_content %}
<!-- ************************ DETAIL ************************ -->
{% include "b3portal/client/include/client_detail.html" %}
<br/>
<!-- ************************ ALIASES ************************ -->
{% if obj_perms.portal.viewalias %}
<div id="client_aliases">
{% include "b3portal/client/include/client_aliases.html" %}
</div>
<br/>
<!-- ************************ IP ALIAS ************************ -->
{% ifsetting SUPPORT_IP_ALIASES %}
<div id="client_ipaliases">
{% include "b3portal/client/include/client_ipaliases.html" %}
</div>
<br/>
{% endifsetting %}
{% endif %}
<!-- ************************ PENALTIES ************************ -->
{% if obj_perms.portal.listpenalties %}
<div id="client_penalties">
{% include "b3portal/client/include/client_penalties.html" %}
</div>
<br/>
<!-- ************************ NOTICES ************************ -->
<div id="client_notice">
{% include "b3portal/client/include/client_notices.html" %}
</div>
<br/>
<!-- ************************ PAST PENALTIES ************************ -->
<div id="past_penalties">
{% include "b3portal/client/include/client_ipenalties.html" %}
</div>
<br/>
{% endif %} <!-- PERM ENDIF -->
<!-- ************************ ADMIN ACTIONS ************************ -->
{% if obj_perms.portal.viewadminsinfo %}    
<div id="admin_actions">
{% include "b3portal/client/include/client_adminactions.html" %}
</div>
<br/>
{% endif %}
<!-- ************************ PORTAL ACTIONS ************************ -->
{% comment %}{% if obj_perms.portal.viewauditlogs %}{% endcomment %}
{% if client_auditlogs %}    
<div id="portal_actions">
{% include "b3portal/client/include/client_audit.html" %}
</div>
<br/>
{% endif %}
{% endblock %}