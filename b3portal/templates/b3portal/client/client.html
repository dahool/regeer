{% extends "base_layout.html" %}
{% load i18n tagutils settingstag extendedtags geoip urltag plugintag gametag %}
{% block title %}{{ block.super }} | {{client.name}}{% endblock %}
{% block extra_header %}
{{ block.super }}
<link rel="stylesheet" type="text/css" href="{% setting "UI_MEDIA_PATH" %}{% setting "UI_VERSION" %}/themes/base/jquery-ui.css"/>
<script type="text/javascript" src="{% setting "UI_MEDIA_PATH" %}{% setting "UI_VERSION" %}/jquery-ui.min.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/jquery.jeditable.mini.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/client.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/client2.js"></script>
<script type="text/javascript">
function update_portal_act() {
	$("#portal_actions").load('{% serverurl client_more_logs client.id %}');
}
function load_penalties() {
    $("#client_penalties").load('{% serverurl client_more_penalties client.id %}');
    update_portal_act()
}
function load_notices() {
    $("#client_notice").load('{% serverurl client_more_notices client.id %}');
    update_portal_act()
}
$(document).ready(function() {
    $("#main").on('click',"a[confirm]",function() {
        var url = $(this).attr('alt');
        var callback = $(this).attr('callback');
        var dialog = $('<div id="dialog-confirm" style="display:none;">{% trans "Are you sure you want to remove this?" %}</div>').appendTo('body');
        dialog.dialog({
            resizable: false,
            width: 350,
            height:150,
            modal: true,
            title: '{% trans "Confirmation required" %}',
            buttons: {
                "Yes": function() {
                	$(this).dialog( "close" );
                	$.get(url, function() {
                		update_user_messages()
                		if (window.hasOwnProperty(callback)) window[callback]();
                	})
                },
                "Cancel": function() {
                    $(this).dialog( "close" );
                }
            }
        });         
    });
    
	{% if change_group %}
	var group_data = '{{group_data|safe}}';
    $('#client_group.icon_edit').editable('{% serverurl change_clientgroup client.id %}', {
    	data   : function() { return group_data; },
        type    : 'select',
        submit  : '{% trans "Save" %}',
        indicator : '{% trans "Saving..." %}',
        callback : function(value, settings) {
        	$.get('{% serverurl list_groups client.id %}', function(data) {
        		if (isEmpty(data)) {
        			$('#client_group').removeClass('nodecoration_icon icon_edit');
        			$('#client_group').attr('title','');
        			$('#client_group').unbind();
        		} else {
        			group_data = data;
        		}
        	});
        	update_user_messages(update_portal_act);
        }        
    });		
    {% endif %}
});
</script>
{% endblock %}
{% block navigation2 %}
{% include "b3portal/client/client_menu.html" %}
{% endblock %}
{% block main_content %}
<!-- ************************ DETAIL ************************ -->
{% include "b3portal/client/include/client_detail.html" %}
<br/>
<!-- ************************ ALIASES ************************ -->
{% if obj_perms.portal.viewalias %}
<div id="client_aliases">
{% include "b3portal/client/include/client_aliases.html" %}
</div>
<br/>
<!-- ************************ IP ALIAS ************************ -->
{% ifsetting SUPPORT_IP_ALIASES %}
<div id="client_ipaliases">
{% include "b3portal/client/include/client_ipaliases.html" %}
</div>
<br/>
{% endifsetting %}
{% endif %}
<!-- ************************ PENALTIES ************************ -->
{% if obj_perms.portal.listpenalties %}
<div id="client_penalties">
{% include "b3portal/client/include/client_penalties.html" %}
</div>
<br/>
<!-- ************************ NOTICES ************************ -->
<div id="client_notice">
{% include "b3portal/client/include/client_notices.html" %}
</div>
<br/>
<!-- ************************ PAST PENALTIES ************************ -->
<div id="past_penalties">
{% include "b3portal/client/include/client_ipenalties.html" %}
</div>
<br/>
{% endif %} <!-- PERM ENDIF -->
<!-- ************************ ADMIN ACTIONS ************************ -->
{% if obj_perms.portal.viewadminsinfo %}    
<div id="admin_actions">
{% include "b3portal/client/include/client_adminactions.html" %}
</div>
<br/>
{% endif %}
<!-- ************************ PORTAL ACTIONS ************************ -->
{% comment %}{% if obj_perms.portal.viewauditlogs %}{% endcomment %}
{% if client_auditlogs %}    
<div id="portal_actions">
{% include "b3portal/client/include/client_audit.html" %}
</div>
<br/>
{% endif %}
{% endblock %}